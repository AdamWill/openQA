% layout 'default';
% title 'Welcome';
<div class="grid_16 box box-shadow omega">
	<h2>Test result overview</h2>
	<p>This page lists <%= @$slist + @$list %> automated test-results from the last <%= $hoursfresh %> hours.</p>
		%= form_for tests => (method => 'GET') => (class => "cutofftimeform") => begin
      %= select_field hours => [ ['24 h' => '24'], ['96 h' => '96'], ['200 h' => '200'], ['300 h' => '300'] ]
      %= text_field "match"
      filter
      <label>
        %= check_box "ib" => 1
        ignore boring results
      </label>
      %= select_field ob => [ ['All Backends' => ''], ['kvm2usb' => 'kvm2usb'], ['qemu' => 'qemu'], ['vbox' => 'vbox'] ]
			%= submit_button "change", class => "smbutton"
    % end
	<p />
	<table style="width: 95%;" id="results" class="table-autosort table-autofilter table-autostripe table-stripeclass:odd">
		<thead>
		  <tr>
        <th class="table-sortable:alphanumeric">link</th>
        <th class="table-sortable:alphanumeric table-filterable">backend</th>
        <th class="table-sortable:alphanumeric table-filterable">distri</th>
        <th class="table-sortable:alphanumeric table-filterable">type</th>
        <th class="table-sortable:alphanumeric table-filterable">arch</th>
        <th class="table-sortable:alphanumeric table-filterable">build</th>
        <th class="table-sortable:alphanumeric table-filterable">extra</th>
        <th class="table-sortable:date">testtime</th>
        <th class="table-sortable:numeric">OK</th>
        <th class="table-sortable:numeric">unk</th>
        <th class="table-sortable:numeric">fail</th>
		  </tr>
		</thead>
		<tbody>
      % for my $test (@$slist) {
		    <tr>
          <%
            my $prio = $test->{'priority'};
            my $href = "/schedule/".$test->{'testname'}."?back=1&action=setpriority&priority=";
            my $state = $test->{'state'};
          %>
          <td style="font-style: italic;"><%= $state %>
          % if ($state eq 'stopped') {
            <%= link_to "AAA" => begin %><%= image "images/toggle.png", alt => "restart", title => "Restart job"; %><% end %>
          % }
          <td>
            <%= link_to "-" => $href.($prio-10) %>
            <%= $prio %>
            <%= link_to "+" => $href.($prio+10) %>
          </td>
          <td><%= $test->{'distri'} %></td>
          <td><%= $test->{'type'} %></td>
          <td><%= $test->{'arch'} %></td>
          <td>
            <span class="textlink">
              <%= link_to 'http://mojolicio.us' => begin %><%= $test->{'build'} %><% end %>
            </span>
          </td>
          <td><span class=""><%= $test->{'extrainfo'} %></span></td>
          <td colspan="4" style="padding: 3px 4px; font-style: italic;">
            <a href="/schedule/<%= $test->{'testname'} %>?cancel=1" onclick="this.href += '&redirect_back=1'" rel="nofollow">cancel</a>
          </td>
  		  </tr>
      % }
		</tbody>
	</table>
	<p>Note: times are UTC</p>
</div>
